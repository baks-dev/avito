/*
 *  Copyright 2025.  Baks.dev <admin@baks.dev>
 *
 *  Permission is hereby granted, free of charge, to any person obtaining a copy
 *  of this software and associated documentation files (the "Software"), to deal
 *  in the Software without restriction, including without limitation the rights
 *  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 *  copies of the Software, and to permit persons to whom the Software is furnished
 *  to do so, subject to the following conditions:
 *
 *  The above copyright notice and this permission notice shall be included in all
 *  copies or substantial portions of the Software.
 *
 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 *  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 *  FITNESS FOR A PARTICULAR PURPOSE AND NON INFRINGEMENT. IN NO EVENT SHALL THE
 *  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 *  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 *  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 *  THE SOFTWARE.
 */

limitAvitoKitCollectionItems=4;deletedAvitoKitCollectionItems=new Map;AvitoKitCollectionItemKey=0;executeFunc((function initAvitoTokenKits(){const form=new FormData(document.forms.avito_token_new_edit_form);const avitoTokenFormHTML=document.forms.avito_token_new_edit_form;const kitCollectionBtnAdd=document.getElementById("kit_сollection_add");kitCollectionBtnAdd.addEventListener("click",addKitItem);const currentDeleteBtns=document.getElementById("kit_сollection").querySelectorAll(".del-item-kit");if(currentDeleteBtns){deleteKitItem(currentDeleteBtns)}return true}));function addKitItem(){const kitCollection=document.getElementById("kit_сollection");AvitoKitCollectionItemKey=this.dataset.index;if(deletedAvitoKitCollectionItems.size>0){let last="";deletedAvitoKitCollectionItems.forEach((function(value){last=value}));AvitoKitCollectionItemKey=last;deletedAvitoKitCollectionItems.delete("key"+last)}const prototypeName=this.dataset.prototype;const prototypeElement=document.getElementById(prototypeName);let prototypeContent=prototypeElement.dataset.prototype;let index=parseInt(this.dataset.index)+1;this.setAttribute("data-index",index);if(parseInt(this.dataset.index)>limitAvitoKitCollectionItems){this.setAttribute("data-index",limitAvitoKitCollectionItems);return}prototypeContent=prototypeContent.replace(/__kit__/g,AvitoKitCollectionItemKey);const parser=new DOMParser;const result=parser.parseFromString(prototypeContent,"text/html");const prototypItem=result.getElementById("prototypeItem").querySelector(".item-kit");kitCollection.append(prototypItem);const deleteBtns=kitCollection.querySelectorAll(".del-item-kit");deleteKitItem(deleteBtns)}function deleteKitItem(buttons){buttons.forEach((function(btn){btn.addEventListener("click",(function(){let deteteItemId=btn.id.replace(/delete-/g,"");const itemForDelete=document.getElementById(deteteItemId);const deleteIndex=btn.id.replace(/delete-avito_token_form_kit-/g,"");deletedAvitoKitCollectionItems.set("key"+deleteIndex,deleteIndex);if(itemForDelete){let addBtn=document.getElementById("kit_сollection_add");const newIndex=parseInt(addBtn.dataset.index)-1;addBtn.setAttribute("data-index",newIndex);itemForDelete.remove()}}))}))}